<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>世界の高い建物ランキング</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dela+Gothic+One&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Dela Gothic One", sans-serif;
        background: linear-gradient(to bottom, #f0f4f8, #c7e2f5);
      }
      #chart {
        width: 90%;
        margin: auto;
        display: flex;
        justify-content: center;
        background-color: #f9f9f9;
        padding: 40px;
        min-height: 100vh;
        box-sizing: border-box;
      }

      #chart svg {
        width: 100%;
        height: auto;
        background: none;
      }

      h1 {
        text-align: center;
        color: #333;
        font-size: 2.8rem;
        font-weight: 400;
      }
      .label {
        fill: #333;
        font-size: 10px;
      }
      .value {
        fill: #555;
        font-weight: bold;
        font-size: 14px;
      }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <h1>世界の高い建物ランキング</h1>
    <div id="chart"></div>

    <script>
      const dataset = [
        {
          label: "ブルジュ・ハリファ（UAE・ドバイ）",
          value: 828,
          flag: "https://flagcdn.com/w40/ae.png",
        },
        {
          label: "ムルデカ118（マレーシア・クアラルンプール）",
          value: 679,
          flag: "https://flagcdn.com/w40/my.png",
        },
        {
          label: "東京スカイツリー（日本・東京）",
          value: 634,
          flag: "https://flagcdn.com/w40/jp.png",
        },
        {
          label: "上海タワー（中国・上海）",
          value: 632,
          flag: "https://flagcdn.com/w40/cn.png",
        },
        {
          label:
            "アブラージュ・アル・ベイト・タワーズ（サウジアラビア・メッカ）",
          value: 601,
          flag: "https://flagcdn.com/w40/sa.png",
        },
      ];

      const colors = ["#3b4d61", "#5b7db1", "#a7bed3", "#c7e2f5", "#dbe3e8"];
      const width = 550;
      const height = 280;

      const xScale = d3
        .scaleLinear()
        .domain([0, d3.max(dataset, (d) => d.value)])
        .range([0, width - 120]);

      const svg = d3
        .select("#chart")
        .append("svg")
        .attr("viewBox", `0 0 ${width} ${height}`);

      // 国旗
      svg
        .selectAll("image.flag")
        .data(dataset)
        .join("image")
        .attr("class", "flag")
        .attr("xlink:href", (d) => d.flag)
        .attr("x", 0)
        .attr("y", (d, i) => i * 40 + 2)
        .attr("width", 30)
        .attr("height", 20);

      // ラベル
      svg
        .selectAll(".label")
        .data(dataset)
        .join("text")
        .classed("label", true)
        .attr("x", 45)
        .attr("y", (d, i) => i * 40 + 15)
        .text((d, i) => `${i + 1}位：${d.label}`);

      // 棒グラフ
      svg
        .selectAll("rect")
        .data(dataset)
        .join("rect")
        .attr("x", 10)
        .attr("y", (d, i) => i * 40 + 25)
        .attr("width", (d) => xScale(d.value))
        .attr("height", 14)
        .attr("rx", 4)
        .attr("fill", (d, i) => colors[i]);

      // 高さの値
      svg
        .selectAll(".value")
        .data(dataset)
        .join("text")
        .classed("value", true)
        .attr("x", (d) => xScale(d.value) + 30)
        .attr("y", (d, i) => i * 40 + 38)
        .text((d) => `${d.value}m`);

      // タワー画像
      const imgWidth = width * 0.25;
      const imgHeight = imgWidth;
      svg
        .append("image")
        .attr(
          "xlink:href",
          "https://thumb.photo-ac.com/a1/a1ccc28ca3cee06ae6dc9c09d5abe614_t.jpeg"
        )
        .attr("width", imgWidth)
        .attr("height", imgHeight)
        .attr("x", width - imgWidth - 10)
        .attr("y", height - imgHeight - 10);
    </script>
  </body>
</html>
