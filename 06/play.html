<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>p5play</title>
    <style>
      canvas {
        border: 1px solid #aaa;
      }
    </style>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/addons/p5.sound.min.js"></script>
    <!-- planck -->
    <script src="https://cdn.jsdelivr.net/npm/planck@latest/dist/planck.min.js"></script>
    <!-- Version 3 of p5.play -->
    <script src="https://p5play.org/v3/p5play.js"></script>
    <script>
      let player, floor;
      let enemies;
      let isGameOver = false;

      // ★ 1. 画像用の変数を準備
      let playerImg;
      let enemyImg;

      // ★ 2. 画像を先読みするための特別な関数
      function preload() {
        // ファイル名は、実際に保存した画像の名前に書き換えてください
        // HTMLファイルと同じフォルダに置くのが一番簡単です
        playerImg = loadImage('player.svg');
        enemyImg = loadImage('enemy.svg');
      }

      function setup() {
        createCanvas(640, 480);
        world.gravity.y = 10;

        // --- プレイヤー ---
        player = new Sprite(100, 350); // ★サイズ指定(40)を省略すると、画像のサイズが自動で使われる
        // ★ 画像を設定
        player.image = playerImg;

        // 画像を設定した場合、元の色やテキストは不要になるので削除またはコメントアウト
        // player.color = '#00f';
        // player.text = 'Jump!';
        // player.textColor = '#fff';

        player.rotationLock = true;
        // もし画像のサイズが大きすぎる場合は、ここで強制的に指定も可能
        player.scale = 0.1; // 10%の大きさに縮小

        // --- 床 ---
        floor = new Sprite(320, 400, 500, 30);
        floor.color = '#666';
        floor.collider = 'static';

        // --- 敵グループ ---
        enemies = new Group();
        // ★ グループに画像を設定
        enemies.image = enemyImg;
        // enemies.w = 40;
        // enemies.h = 40;
        // enemies.color = '#f00';
        enemies.collider = 'kinematic';
        enemies.scale = 0.1;
      }

      function draw() {
        background(255);

        if (isGameOver) {
          fill(0);
          textSize(50);
          textAlign(CENTER);
          text('GAME OVER', width / 2, height / 2);
          return;
        }

        // --- 1. プレイヤーの操作 ---
        if (kb.pressing('right')) {
          player.vel.x = 5;
        } else if (kb.pressing('left')) {
          player.vel.x = -5;
        } else {
          player.vel.x = 0;
        }

        if (kb.presses('up') && player.colliding(floor)) {
          player.vel.y = -5;
        }

        // --- 2. 敵の出現 ---
        // 120フレーム（約2秒）ごとに敵を出す
        if (frameCount % 120 === 0) {
          let enemy = new enemies.Sprite(width, 380);
          enemy.vel.x = -5; // 左へ進む
        }

        // 画面から100px以上はみ出たら消す
        enemies.cull(100);

        // --- 3. 衝突判定 ---
        if (player.collides(enemies)) {
          isGameOver = true;
          // player.color = '#666'; // 画像の場合は色が変えられないのでコメントアウト
          player.tint = '#666'; // 代わりに tint（色合い）を変えることでダメージ表現ができる
        }
      }
    </script>
  </body>
</html>
